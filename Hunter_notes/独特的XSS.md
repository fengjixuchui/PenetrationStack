# 漏洞散记
##  一个比较独特的XSS
> Shopify的一个漏洞，这个XSS我感觉十分的独特，因为主要的原因就是其功能实在是太过独特，所以才能实现前台对后台弹窗

> 漏洞价值:1500$

>源地址:[#214044](https://hackerone.com/reports/214044)

## 漏洞过程

Shopify的私人店铺功能十分强大，可以各种定制，其中在`/orders`里面有一个功能就是能够查看订单，而且其中还有个奇葩的属性能看到客户浏览了什么页面，功能做出来应该是为了大数据，能够进行数据挖掘下次对客户作出相应的推荐

但就是这个观察浏览页面的功能出了问题

## 关键点
什么记录了用户的浏览？Shopify采用的是cookie的方式去记录，也就是`_landing_page`这个cookie，比如我正在浏览的是`[shop].myshopify.com/password`,那么`_landing_page`的值就是`/password`,这样后台能看到的用户浏览的页面就是`/password`

作者在这儿就想到了，如果把`/password`改成xss代码呢？

结果很显然，后台并没有验证`_landing_page`的值是否是一个路径，而是直接带入到后台环境中

这儿我并没有去复现，因为开启order功能得先买个店铺，最便宜的也得27$一个月，想想还是算了，所以完全属于推测出来漏洞的实现过程

## 作者攻击过程

1. 作者先访问一个店铺
2. Modify `_landing_page` cookie value to `javascript:alert(1)`，修改cookie
3. 完成购买过程，生成order
4. 后台选取此order，然后点击浏览功能，也就是`The first page they visited`
5. 后台弹窗

## 漏洞总结

这个XSS我只能说十分的巧妙，并不是巧妙在构造，而是巧妙在逻辑，整个漏洞的发现到利用，完全合乎逻辑，仿佛只要没有过滤，就一定存在漏洞一样，前台打到后台，就需要有一个前后台交互的地方，而order正好就是这个地方，而对于一个order来说，能够由攻击者任意修改的东西有哪些？备注，数量，还有就是cookie，而cookie往往就是最容易被人遗忘的一个点
